# Notion API検証スクリプト使用方法

## 概要

このテストスクリプト(`test_notion.py`)はNotion APIの接続とデータベース/ページIDの検証を行うためのツールです。エラー「Could not find database with ID」の原因調査に役立ちます。

## 実行方法

### 1. 環境変数の確認

`.env`ファイルに以下の項目が正しく設定されていることを確認してください：

```
# Notion API設定
NOTION_API_KEY=your_notion_api_key
NOTION_DATABASE_ID=your_database_id_or_page_id
```

* `NOTION_API_KEY`: Notionインテグレーションの内部統合トークン
* `NOTION_DATABASE_ID`: 検証したいデータベースIDまたはページID

### 2. 実行手順

ターミナルで以下のコマンドを実行します：

```bash
python test_notion.py
```

### 3. 出力結果の解釈

#### 3.1 データベースアクセステスト

このテストでは、指定したIDがデータベースIDとして有効かどうかを確認します。

**成功の場合**:
```
✅ データベースへのアクセステスト: 成功
```

**失敗の場合**:
```
❌ データベースへのアクセステスト: 失敗
```

詳細なエラーメッセージを確認し、原因を特定してください。一般的なエラー：
- `Could not find database` - データベースが存在しないか、アクセス権がない
- `API token is invalid` - APIキーが無効

#### 3.2 IDの種類検証

このテストでは、指定したIDが「データベースID」なのか「ページID」なのかを判別します。

**データベースIDの場合**:
```
✅ IDはデータベースIDとして有効です: 1c9a18c6848c80afbbc3edb875805be4
データベース名: [データベース名が表示されます]
```

**ページIDの場合**:
```
❌ IDはデータベースIDとして無効です: [エラーメッセージ]
✅ IDはページIDとして有効です: 1c9a18c6848c80afbbc3edb875805be4
ページURL: https://www.notion.so/...
注意: ページIDが設定に保存されています。データベースIDであることを確認してください。
```

## トラブルシューティング

### 1. 共有設定の確認

エラーが発生する場合、Notionデータベースとインテグレーションが正しく共有されているか確認してください：
1. Notionでデータベースページを開く
2. 右上の「・・・」メニューをクリック
3. 「接続を追加」を選択
4. 該当するインテグレーションを選択/確認

### 2. インテグレーション権限の確認

Notionインテグレーションの設定ページで以下の権限が有効になっていることを確認：
- コンテンツの読み取り (Read content)
- コンテンツの挿入 (Insert content)
- コンテンツの更新 (Update content)

### 3. IDフォーマットの確認

Notion IDは通常32文字で、ハイフン付き/なしの両形式が使われます：
- ハイフン付き: `1c9a18c6-848c-80af-bbc3-edb875805be4`
- ハイフンなし: `1c9a18c6848c80afbbc3edb875805be4`

スクリプトは両方のフォーマットで自動的にテストします。 